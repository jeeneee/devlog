---
title: 'ë¼ì¦ˆë² ë¦¬íŒŒì´4 k8s í´ëŸ¬ìŠ¤í„° êµ¬ì¶• 1'
slug: 'k8s-on-raspberry-pi'
description: 'ë¼ì¦ˆë² ë¦¬íŒŒì´ 4ëŒ€ë¡œ k8s í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤.'
tags: ["k8s", "raspberry pi"]
pubDate: '2025-03-23'
---
## Intro
ì‘ë…„ ë¼ì¦ˆë² ë¦¬íŒŒì´4 4ëŒ€ë¥¼ ì´ìš©í•˜ì—¬ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.

ë‹¹ì‹œì—” ë…¸ì…˜ì— ëŒ€ì¶© ì •ë¦¬ë§Œ í–ˆì—ˆëŠ”ë°, ì´ë²ˆ ê¸°íšŒì— ìµœì‹  ë²„ì „ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ì„œ êµ¬ì¶• ê³¼ì •ì— ëŒ€í•´ ìì„¸íˆ ë‹¤ë¤„ë³´ë ¤ í•©ë‹ˆë‹¤.
ê¼­ ë¼ì¦ˆë² ë¦¬íŒŒì´ê°€ ì•„ë‹ˆë”ë¼ë„ ë¯¸ë‹ˆPCì—ì„œ k8së¥¼ ì„¤ì¹˜í•˜ê³  ì‹¶ì€ ë¶„ë“¤ì—ê²Œë„ ë„ì›€ì´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.
![raspberry pi cluster](raspberry-pi-cluster.png "raspberry pi cluster")
![gs380v3](gs380v3.png "gs380v3")

ì•„ë˜ ì¥ë¹„ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.
- ë¼ì¦ˆë² ë¦¬íŒŒì´4, 4(ë§ˆìŠ¤í„° ë…¸ë“œ 1 + ì›Œì»¤ ë…¸ë“œ 3)
- M.2 NVMe SSD 128GB, 4(nfs êµ¬ì„±x)
- SSD Enclosure, 4
- 8í¬íŠ¸ ê¸°ê°€ë¹„íŠ¸ ìŠ¤ìœ„ì¹˜

## 1. ë¼ì¦ˆë² ë¦¬íŒŒì´ ê¸°ë³¸ ì„¤ì •
### OS ì„¤ì¹˜
[Raspberry Pi Imager](https://www.raspberrypi.com/software)ë¥¼ í†µí•´ SSDì— Ubuntu OSë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
ì €ëŠ” Ubuntu Server 24.04.2 LTS(64bit)ë¡œ ì„ íƒí•˜ê³  ê³µê°œí‚¤ ì¸ì¦ ê¸°ë°˜ ssh ì„¤ì •ë„ í–ˆìŠµë‹ˆë‹¤.
ê° host ë’¤ì— ìˆ«ìë¥¼ ë¶™ì´ë©´ êµ¬ë¶„ì´ ì‰½ìŠµë‹ˆë‹¤.
```bash
$ ssh-keygen -t rsa # ìƒì„±ëœ ê³µê°œí‚¤ ì „ë¬¸ ë³µë¶™
```

### DHCP ê³ ì • í• ë‹¹
ì‚¬ì„¤ IP ë³€ê²½ ë°©ì§€ë¥¼ ìœ„í•´ DHCP ê³ ì • í• ë‹¹ì„ í•´ì¤ë‹ˆë‹¤. ì €ëŠ” ê° í˜¸ìŠ¤íŠ¸ ë²ˆí˜¸ì— ë§ê²Œ 192.168.219.13[1:4]ë¡œ ì§€ì •í•˜ì˜€ìŠµë‹ˆë‹¤.

### ssh ì ‘ì†
```bash
$ ssh -i .ssh/rasp username@192.168.219.131

# ë˜ëŠ” ì•„ë˜ì™€ ê°™ì´ .ssh/configì— ì¶”ê°€í•˜ë©´ í¸í•©ë‹ˆë‹¤.
Host rasp1
    HostName 192.168.219.131
    User username
    IdentityFile ~/.ssh/rasp # ê°œì¸í‚¤
```
ë²Œì¨ë¶€í„° ì™¸ë¶€ ì ‘ì†ì„ ì›í•œë‹¤ë©´ NAT ì„¤ì • í›„ ê³µì¸ IPë¥¼ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.

ëª¨ë“  ë…¸ë“œ ëŒ€ìƒìœ¼ë¡œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. tmuxê°™ì€ íˆ´ì„ ì“°ë©´ í¸í•©ë‹ˆë‹¤.
```bash
$ sudo apt-get update
$ sudo apt-get upgrade

$ sudo rpi-eeprom-update -a
$ sudo rpi-eeprom-config --edit
# ë§ˆì§€ë§‰ ì¤„ BOOT_ORDER=0xf14 ë³€ê²½ í›„ ì¬ë¶€íŒ…
```
ë…¸ë“œ ë¶€íŒ… ì‹œ USBë¥¼ ë¨¼ì € ë³´ë„ë¡ [ë¼ì¦ˆë² ë¦¬íŒŒì´ì˜ boot order](https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#boot_order-examples)ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.

### swap ë©”ëª¨ë¦¬ ë¹„í™œì„±í™”
ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¤ì™‘ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ë©”ëª¨ë¦¬ ê´€ë¦¬ ì˜ˆì¸¡ì´ ì–´ë ¤ì›Œ í•´ë‹¹ ë…¸ë“œì—ì„œì˜ ì‹¤í–‰ì„ ê±°ë¶€í•©ë‹ˆë‹¤.([ì°¸ê³ ](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#swap-configuration))

ë”°ë¼ì„œ ëª¨ë“  ë…¸ë“œì— ëŒ€í•´ swap memoryë¥¼ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.
```bash
$ sudo swapoff -a
$ sudo sed -i.bak -r 's/(.+ swap .+)/#\1/' /etc/fstab # ì˜êµ¬ ë¹„í™œì„±í™”
```

## 2. ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜(v1.32)
podì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” container runtimeì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì´ë¥¼ êµ¬í˜„í•˜ëŠ” [ì—¬ëŸ¬ runtime](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-runtime)
(containerd, CRI-O, cri-dockerdë¥¼ ì‚¬ìš©í•˜ëŠ” ë„ì»¤ ì—”ì§„) ì¤‘ ì›í•˜ëŠ” ê²ƒì„ ì„¤ì¹˜í•˜ë©´ ë©ë‹ˆë‹¤.(v1.24 ì´í›„ë¶€í„° ê·¸ëƒ¥ ë„ì»¤ ì—”ì§„ì€ ì§€ì› ì•ˆí•¨)

ì—¬ê¸°ì„  `containerd`ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

### containerd ì„¤ì¹˜
[containerd github](https://github.com/containerd/containerd/blob/main/docs/getting-started.md)ì„ ì°¸ê³ í•˜ì—¬ ì›í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì„¤ì¹˜í•˜ë©´ ë©ë‹ˆë‹¤.

#### option 2: apt-get
docker ê³µì‹ ë¬¸ì„œì—ì„œ containerdë§Œ ì„¤ì¹˜í•©ë‹ˆë‹¤.
- step1: docker apt repository ì¶”ê°€
```bash
# Add Docker's official GPG key:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
```
- step2: containerd ì„¤ì¹˜
```bash
sudo apt-get install containerd.io
```
- step3: CNI plugins ì„¤ì¹˜(CNI)
```bash
$ sudo mkdir -p /opt/cni/bin
$ wget https://github.com/containernetworking/plugins/releases/download/v1.6.2/cni-plugins-linux-arm64-v1.6.2.tgz
$ sudo tar Cxzvf /opt/cni/bin cni-plugins-linux-arm64-v1.6.2.tgz
$ rm cni-plugins-linux-arm64-v1.6.2.tgz
```

### cgroup ì„¤ì •
#### containerd
`/etc/containerd/config.toml`ì„ ë³´ë©´ 1)`disabled_plugins = ["cri"]` ë˜ì–´ ìˆê³ , 2)runc ê´€ë ¨ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ containerdì˜ ê¸°ë³¸ ì„¤ì • íŒŒì¼ë¡œ êµì²´í•˜ê³ ,
[systemd cgroup driver ì„¤ì •](https://kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd-systemd)ê³¼ ê°™ì´ systemCgroup ì„¤ì •ì„ í•©ë‹ˆë‹¤.
```bash
$ sudo su
$ containerd config default >/etc/containerd/config.toml
$ vi /etc/containerd/config.toml # runc.options.systemCgroup false -> true ë³€ê²½
$ systemctl restart containerd
$ systemctl enable containerd
```
#### ë¼ì¦ˆë² ë¦¬íŒŒì´
ARM ê³„ì—´ ë¦¬ëˆ…ìŠ¤ëŠ” ë³´í†µ cgroupì´ êº¼ì ¸ ìˆëŠ” ê²½ìš°ê°€ ë§ë‹¤ê³  í•©ë‹ˆë‹¤. cgroupì„ í†µí•´ ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬ ë° ì œì–´í•´ì•¼ í•˜ë¯€ë¡œ ì»¤ë„ ë¶€íŒ… ì˜µì…˜ì„ í†µí•´ ì´ë¥¼ í™œì„±í™” í•©ë‹ˆë‹¤.
```bash
$ cgroup="$(head -n1 /boot/firmware/cmdline.txt) cgroup_enable=cpuset cgroup_enable=memory cgroup_memory=1 swapaccount=1"
$ echo $cgroup | sudo tee /boot/firmware/cmdline.txt
$ sudo reboot
```
- cgroup_enable=cpuset: CPU ì„¸íŠ¸(CPU ë¶„ë¦¬ ì œì–´) í™œì„±í™”.
- cgroup_enable=memory: ë©”ëª¨ë¦¬ ë¦¬ì†ŒìŠ¤ ì œì–´ í™œì„±í™”.
- cgroup_memory=1: ë©”ëª¨ë¦¬ cgroup ì„¸ë¶€ ì˜µì…˜.
- swapaccount=1: cgroupì„ í†µí•´ swap ì‚¬ìš©ëŸ‰ê¹Œì§€ ì¶”ì í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì˜µì…˜.(swapì€ ê»ì§€ë§Œ)

### [kubelet, kubeadm, kubectl ì„¤ì¹˜](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl)
> - kubelet: ë…¸ë“œ ì—ì´ì „íŠ¸(ë°ëª¬ ë°±ê·¸ë¼ìš´ë“œ)
> - kubeadm: k8s í´ëŸ¬ìŠ¤í„° ì„¤ì¹˜ íˆ´
> - kubectl: k8s í´ëŸ¬ìŠ¤í„° ëª…ë ¹ íˆ´

```bash
$ sudo apt-get update
$ sudo apt-get install -y apt-transport-https ca-certificates curl gpg
# sudo mkdir -p -m 755 /etc/apt/keyrings # `/etc/apt/keyrings` ì—†ìœ¼ë©´ ë°˜ë“œì‹œ ìƒì„±
$ curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.32/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
$ echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.32/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
$ sudo apt-get update
$ sudo apt-get install -y kubelet kubeadm kubectl
$ sudo apt-mark hold kubelet kubeadm kubectl
$ sudo systemctl enable --now kubelet
```

#### [ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ë„¤íŠ¸ì›Œí¬ ì„¤ì •](https://kubernetes.io/docs/setup/production-environment/container-runtimes/#network-configuration)
ë¦¬ëˆ…ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì•ˆìƒ ì¸í„°í˜ì´ìŠ¤ ê°„ IP íŒ¨í‚· í¬ì›Œë”©(ë¼ìš°íŒ…)ì„ í—ˆìš©í•˜ì§€ ì•Šì§€ë§Œ, k8s ê°™ì€ ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤ê°€ í•„ìš”í•˜ë©´ ì§ì ‘ ì—´ì–´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
```bash
# ë¶€íŒ… ì‹œ ìë™ ë¡œë“œ
$ cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
overlay
br_netfilter
EOF

$ sudo modprobe overlay # ì¦‰ì‹œ ë¡œë“œ
$ sudo modprobe br_netfilter # ì¦‰ì‹œ ë¡œë“œ

# sysctl ì»¤ë„ íŒŒë¼ë¯¸í„° ì„¤ì •
$ cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

# ì¬ë¶€íŒ… ì—†ì´ ì ìš©
$ sudo sysctl --system

$ sysctl net.ipv4.ip_forward # 1ì¸ì§€ í™•ì¸
```
- overlay: ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ê³„ì¸µí™”(containerd ë“±ì´ ì‚¬ìš©í•˜ëŠ” overlayfs)
- br_netfilter: bridge ë„¤íŠ¸ì›Œí¬ ìƒì˜ íŠ¸ë˜í”½ë„ iptablesë¡œ í•„í„°ë§

### í´ëŸ¬ìŠ¤í„° êµ¬ì„±
ì´ì œ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤. [ë§ì€ CNI](https://kubernetes.io/docs/concepts/cluster-administration/addons/#networking-and-network-policy) ì¤‘ì—ì„œ ê¸°ë³¸ì ì´ê³  ì„¤ì •ì´ ê°„ë‹¨í•œ flannelì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

- ë§ˆìŠ¤í„° ë…¸ë“œ
flannelì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ê¶Œì¥í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ì„ kubeadm init ëª…ë ¹ì˜ ì˜µì…˜ìœ¼ë¡œ ì¶”ê°€í•©ë‹ˆë‹¤. ë„ë©”ì¸ì´ ìˆë‹¤ë©´ apiserver-cert-extra-sansë„ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.
```bash
$ sudo kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-cert-extra-sans={ip or dns names}

$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

- ì›Œì»¤ ë…¸ë“œ
ìœ„ì—ì„œ í´ëŸ¬ìŠ¤í„° ì´ˆê¸°í™” ì„±ê³µ ì‹œ ì¶œë ¥ë˜ëŠ” ëª…ë ¹ì–´ë¥¼ ê·¸ëŒ€ë¡œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.
```bash
$ kubeadm join ...

# deploy a pod network to the cluster ex)flannel
$ kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml
```
êµ¬ì„± ì™„ë£ŒğŸŠ

### ì™¸ë¶€ì—ì„œ í´ëŸ¬ìŠ¤í„° ì ‘ê·¼
> ì™¸ë¶€ì—ì„œ í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ = ë§ˆìŠ¤í„° ë…¸ë“œ(ì»¨íŠ¸ë¡¤ í”Œë ˆì¸)ì—ì„œ ì‹¤í–‰ë˜ëŠ” kube-apiserver ì ‘ê·¼

kube-apiserverëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 6443 í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, í•´ë‹¹ í¬íŠ¸ì— ëŒ€í•œ NAT ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤.
```bash
$ vi /$HOME/.kube/config # kube configì— ì íŒ cluster, context, userë¥¼ ë¡œì»¬ í•´ë‹¹ ìœ„ì¹˜ íŒŒì¼ì— ì¶”ê°€. (ê¸°ì¡´ì— ì—†ìœ¼ë©´ ìƒì„±)
$ kubectl get nodes
```

ì´ì œ ì™¸ë¶€ì—ì„œë„ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ğŸ‰
![kubectl_get_nodes](kubectl-get-nodes.png "kubectl-get-nodes")