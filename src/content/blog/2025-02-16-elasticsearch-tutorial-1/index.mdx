---
title: 'Elasticsearch íŠœí† ë¦¬ì–¼ 1'
slug: 'elasticsearch-tutorial-1'
description: 'Elasticsearchì— ëŒ€í•œ ê¸°ì´ˆì ì¸ ì„¤ëª…ê³¼ êµ¬ì„± ë° ì„¤ì • ë“±ì„ ë‹¤ë£¹ë‹ˆë‹¤.'
tags: ["elasticsearch"]
pubDate: '2025-02-16'
---
Elasticsearchì— ëŒ€í•œ ê¸°ì´ˆì ì¸ ì„¤ëª…ê³¼ êµ¬ì„± ë° ì„¤ì • ë“±ì„ ë‹¤ë£¹ë‹ˆë‹¤.

## Elasticsearchë€?
> [ê³µì‹ ë¬¸ì„œ](https://www.elastic.co/elasticsearch)ì—ì„œëŠ” Elasticsearch(ì´í•˜ ES)ì— ëŒ€í•´ ë¶„ì‚°í˜• ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„ìœ¼ë¡œ,
ë°ì´í„°ë¥¼ ì¤‘ì•™í™”í•˜ì—¬ ë¹ ë¥´ê³  ì •í™•í•œ ê²€ìƒ‰ì„ ì œê³µí•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¼ ì†Œê°œí•˜ê³  ìˆìŠµë‹ˆë‹¤.

ESëŠ” Elastic Stack(Beats, ES, Kibana, Logstash)ì˜ í•µì‹¬ìœ¼ë¡œ, ê°€ê³µëœ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ì €ì¥(ìƒ‰ì¸)í•˜ì—¬ ê²€ìƒ‰ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![elastic stack](elastic-stack.png "elastic stack")

## ì¸ë±ìŠ¤(index)ì™€ ë¬¸ì„œ(document)
ESì—ì„œì˜ ì¸ë±ìŠ¤ë€ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•œ ë…¼ë¦¬ì  ê³µê°„ì…ë‹ˆë‹¤. DBì˜ table ë˜ëŠ” collectionê³¼ ë¹„ìŠ·í•œ ê°œë…ìœ¼ë¡œ ì´í•´ í•  ìˆ˜ ìˆê³ , ë°˜ë“œì‹œ ì¸ë±ìŠ¤ì—
ë°ì´í„°(ì´í•˜ ë¬¸ì„œ, document)ë¥¼ ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤. ì•ìœ¼ë¡œëŠ” ë¬¸ì„œë¥¼ ìƒ‰ì¸í•œë‹¤ê³  í‘œí˜„í•˜ê² ìŠµë‹ˆë‹¤.
ì—¬ê¸°ì„œì˜ ë¬¸ì„œëŠ” ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ìµœì†Œ ë‹¨ìœ„ë©°, JSON í˜•ì‹ìœ¼ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.
```json
{
  "messageId": 10000,
  "chatId": 100,
  "userId": 10,
  "content": "ì•ˆë…•í•˜ì„¸ìš”",
  "createdAt": "2025-02-16T12:34:56.789Z"
}
```

### ë¬¸ì„œ ìƒ‰ì¸
es-head, REST API, kibanaì˜ dev tools ë“±ì„ í†µí•´ ë¬¸ì„œë¥¼ ìƒ‰ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì¤‘ dev toolsë¥¼ í†µí•´ ì˜ˆì œë¥¼ ì‘ì„±í•  ê²ƒì…ë‹ˆë‹¤.
* kibana ë©”ë‰´ > Dev Tools
```
# 1. í…ìŠ¤íŠ¸ ë¶„ì„
GET /message_v0-20250216/_analyze
{
  "text": "elasticsearchëŠ” ë¶„ì‚°í˜• ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„ì…ë‹ˆë‹¤."
}
## ê²°ê³¼: ["elasticsearchëŠ”", "ë¶„ì‚°í˜•", "ê²€ìƒ‰", "ë°", "ë¶„ì„", "ì—”ì§„ì…ë‹ˆë‹¤"]

# 2. ë¬¸ì„œ ìƒ‰ì¸
POST /message_v0-20250216/_doc
{
  "messageId": 10000,
  "chatId": 100,
  "userId": 10,
  "content": "elasticsearchëŠ” ë¶„ì‚°í˜• ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„ì…ë‹ˆë‹¤.",
  "createdAt": "2025-01-01T12:34:56.789Z"
}

# 3. ìƒì„±ëœ ì¸ë±ìŠ¤ ì¡°íšŒ
GET /message_v0-20250216

# 4. ìƒ‰ì¸ëœ ë¬¸ì„œ ì¡°íšŒ
## _id ì¡°íšŒ
GET /message_v0-20250216/_doc/<id>
## ê²€ìƒ‰
GET /message_v0-20250216/_search
{
  "query": {
    "match_all": {}
  }
}
```
1. ê¸°ë³¸ì ìœ¼ë¡œ text í•„ë“œë¥¼ í†µí•´ ë¶„ì„(ì—­ìƒ‰ì¸)ëœ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. analyzerë¥¼ ë³„ë„ë¡œ ì§€ì •í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ê¸°ë³¸ê°’ì¸ standard analyzerê°€ ì‚¬ìš©ë©ë‹ˆë‹¤. (ë„ì–´ì“°ê¸°ë§Œ êµ¬ë¶„)
2. _idë¥¼ ì§€ì •í•˜ì§€ ì•Šê³  ìƒ‰ì¸í•˜ë©´ ES ë‚´ë¶€ì—ì„œ ìƒì„±í•œ hash ê¸°ë°˜ _idê°€ ë©ë‹ˆë‹¤.
3. ìƒì„±ëœ ì¸ë±ìŠ¤ë¥¼ ì¡°íšŒí•˜ë©´ content í•„ë“œê°€ text, keyword ë‘ ê°€ì§€ íƒ€ì…ì¸ ë©€í‹° í•„ë“œë¡œ ìƒì„±ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë‘ ë¬¸ìì—´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ì§€ë§Œ ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤.
    - text: ë¶„ì„(analyze)ì„ ê±°ì³ ë¶„ë¦¬ëœ í† í°ì„ ê°ê° ìƒ‰ì¸í•˜ì—¬ ì „ë¬¸ ê²€ìƒ‰ ì‹œ í™œìš©í•©ë‹ˆë‹¤.
    - keyword: ë¶„ì„ì„ ê±°ì¹˜ì§€ ì•Šê³  ìˆëŠ” ê·¸ëŒ€ë¡œ ìƒ‰ì¸í•©ë‹ˆë‹¤. ì •í™•í•œ ê°’ ë§¤ì¹­, ì§‘ê³„, í•„í„°ë§ ë“±ì˜ ìš©ë„ë¡œ í™œìš©í•©ë‹ˆë‹¤.
4. ì¡°íšŒ ë° ê²€ìƒ‰. í›„ì— ì„œìˆ í•˜ì§€ë§Œ ëª©ì ê³¼ ë™ì‘ ë°©ì‹ì— ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.
    - _id ì¡°íšŒ: ê¸°ë³¸ì ìœ¼ë¡œ shard routingì´ _idë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê²°ì •ë˜ê¸°ì— íŠ¹ì • ìƒ¤ë“œë¡œ ë°”ë¡œ ì´ë™í•´ ë¬¸ì„œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ë”°ë¼ì„œ ë¹ ë¥¼ ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤.
    - ê²€ìƒ‰: Query DSLì„ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ì—¬ëŸ¬ ì¡°ê±´ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¹ì—°íˆ ëª¨ë“  ìƒ¤ë“œì—ì„œ ëª¨ë“  ë¬¸ì„œë¥¼ í™•ì¸í•´ì•¼ í•˜ë¯€ë¡œ ì†ë„ê°€ ëŠë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![es-head](es-head.png "es-head")
es-headì—ì„œ ì‹œê°í™”ëœ ì¸ë±ìŠ¤ êµ¬ì„±ì„ ë³´ë©´, data nodeê°€ 4ê°œì´ê³  `number_of_shards`, `number_of_replicas`ê°€ ê°ê° 4ì™€ 1ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
bold ì²˜ë¦¬ëœ ì‚¬ê°í˜•ì´ primary shard ì…ë‹ˆë‹¤.

![flow](flow.png "flow")
ë‹¤ìŒê³¼ ê°™ì€ ìƒ‰ì¸ ê³¼ì •ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
1. ingest pipeline. ë¬¸ì„œ ì „ì²˜ë¦¬ë¡œ, ingest nodeì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
2. shard routing. ê¸°ë³¸ì ìœ¼ë¡œ `hash(_id) % number_of_shards`ë¡œ ê²°ì •ë©ë‹ˆë‹¤.
3. parse. í…ìŠ¤íŠ¸ëŠ” analyzerì— ì˜í•´ ë¶„ì„ ë° ì—­ìƒ‰ì¸
4. replicate. replica nodeë¡œ ë³µì œ ì‹œì‘
5. buffer: ë©”ëª¨ë¦¬ ë²„í¼ ì ì¬
6. flush(lucene), refresh(es): ì‹œìŠ¤í…œ ìºì‹œì— ì„¸ê·¸ë¨¼íŠ¸ ìƒì„±ë˜ì–´ ê²€ìƒ‰ ê°€ëŠ¥í•œ ìƒíƒœê°€ ë˜ì§€ë§Œ ìœ ì‹¤ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
7. commit(lucene), flush(es): ë¬¼ë¦¬ ë””ìŠ¤í¬ì— ì €ì¥í•˜ì—¬ ì•ˆì „í•œ ìƒíƒœê°€ ë©ë‹ˆë‹¤.

### ë¬¸ì„œ ë¶„ì„
ìœ„ì—ì„œ ì–¸ê¸‰í•œ analyzerëŠ” text field ë‚´ìš©ì— ëŒ€í•´ ë¶„ì„í•©ë‹ˆë‹¤.

analyzer = character filters + tokenizer + token filters
- character filters: í…ìŠ¤íŠ¸ í† í°í™” ì „ì— ì „ì²˜ë¦¬. HTML íƒœê·¸ ì œê±°, íŠ¹ì • ë¬¸ì ë³€í™˜ ë“±ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- tokenizer: í…ìŠ¤íŠ¸ë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•œ ë‹¨ìœ„(í† í°)ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ì–‘í•œ í† í¬ë‚˜ì´ì €ë¥¼ ì œê³µí•˜ëŠ”ë° ê²€ìƒ‰ ëª©ì ì— ë§ê²Œ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. íŠ¹íˆ í•œê¸€ì€ ì£¼ë¡œ ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- token filters: í† í°ì„ í›„ì²˜ë¦¬. ì •ê·œí™” ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

í•œê¸€ì€ `nori`ë¼ëŠ” í•œê¸€ í˜•íƒœì†Œ ë¶„ì„ê¸°ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì°¸ê³  ìë£Œê°€ ë§ìœ¼ë‹ˆ ìì„¸í•œ ë‚´ìš©ì€ ìƒëµí•˜ê³  ìœ„ì˜ ë‚´ìš©ë“¤ì„ ì¢…í•©í•œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ ë³´ê² ìŠµë‹ˆë‹¤.
```
# 1. ì¸ë±ìŠ¤ ìƒì„±
PUT /message_v0-20250216
{
  "settings": {
    "refresh_interval": "1s", // refresh ì£¼ê¸°
    "number_of_shards": 4, // primary shard ìˆ˜
    "number_of_replicas": 1, // replica shard ìˆ˜
    "index": {
      "analysis": {
        "tokenizer": { // tokenizer ì •ì˜
          "nori_tokenizer": {
            "type": "nori_tokenizer", // ES ê¸°ë³¸ ì œê³µ(ì—†ëŠ” ë²„ì „ì€ plugin ì„¤ì¹˜)
            "decompound_mode": "none" // ë³µí•©ì–´ ì–´ê·¼ ë¶„í•´(none | discard | mixed)
          }
        },
        "analyzer": {
          "nori_analyzer": { // analyzer ì •ì˜
            "type": "custom",
            "tokenizer": "nori_tokenizer", // ìœ„ì˜ tokenizer
            "filter": [
              "lowercase", // ì†Œë¬¸ì ë³€í™˜
              "nori_part_of_speech" // stoptags í•„ë“œì— ì •ì˜ëœ í’ˆì‚¬ ì œê±°(ê¸°ë³¸ê°’ ì‚¬ìš©)
              ]
          }
        }
      }
    }
  },
  "mappings": {
    "dynamic": "strict", // ëª…ì‹œì  mapping. nullì€ ê°€ëŠ¥í•˜ì§€ë§Œ ì •ì˜ë˜ì§€ ì•Šì€ í•„ë“œ ì˜ˆì™¸ ë°œìƒ
    "properties": {
      "messageId": { "type": "long" },
      "chatId": { "type": "long" },
      "userId": { "type": "long" },
      "content": {
        "type": "text",
        "analyzer": "nori_analyzer", // ìƒ‰ì¸ìš© ë¶„ì„ê¸°
        "search_analyzer": "nori_analyzer" // ê²€ìƒ‰ìš© ë¶„ì„ê¸°. ìƒëµí•˜ë©´ analyzer ì‚¬ìš©
      },
      "createdAt": { "type": "date" }
    }
  }
}

# 2. í…ìŠ¤íŠ¸ ë¶„ì„
GET /message_v0-20250216/_analyze
{
  "text": "elasticsearchëŠ” ë¶„ì‚°í˜• ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„ì…ë‹ˆë‹¤.",
  "analyzer": "nori_analyzer"
}
## ê²°ê³¼: ["elasticsearch", "ë¶„ì‚°", "ê²€ìƒ‰", "ë¶„ì„", "ì—”ì§„", "ì…ë‹ˆë‹¤"]

# 3. ë¬¸ì„œ ìƒ‰ì¸
POST /message_v0-20250216/_doc/10000 // _id ëª…ì‹œì  ì •ì˜
{
  "messageId": 10000,
  "chatId": 100,
  "userId": 10,
  "content": "elasticsearchëŠ” ë¶„ì‚°í˜• ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„ì…ë‹ˆë‹¤.",
  "createdAt": "2025-01-01T12:34:56.789Z"
}

# 4. ìƒ‰ì¸ëœ ë¬¸ì„œ ì¡°íšŒ
## _id ì¡°íšŒ
GET /message_v0-20250216/_doc/10000
## ê²€ìƒ‰
GET /message_v0-20250216/_search
{
  "query": {
    "term": {
      "userId": {
        "value": 10
      }
    }
  }
}

GET /message_v0-20250216/_search
{
  "query": {
    "match": {
      "content": "ì—”ì§„"
    }
  }
}
```
> ë¬¸ì„œ ìƒ‰ì¸ ì‹œ _idë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì •ì˜í•œ ì´ìœ ëŠ” messageIdê°€ ê³ ë¥´ê²Œ ë¶„í¬ë˜ì–´ ìˆëŠ” ê°€ì • í•˜ì— ìƒ‰ì¸ í›„ ë©”ì‹œì§€ ìˆ˜ì • ë˜ëŠ” ì‚­ì œê°€ ë°”ë¡œ ë°œìƒí•  ê²½ìš° ì¦‰ê° ì¡°ì¹˜í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
_id ê¸°ë°˜ ì‘ì—…ì€ ë¬¸ì„œ ê²€ìƒ‰ ê°€ëŠ¥ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ìˆ˜í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ìœ„ ì¸ë±ìŠ¤ì— ë²„ì „ê³¼ ë‚ ì§œë¥¼ ì¶”ê°€í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. reindexë¥¼ ëŒ€ë¹„í•˜ì—¬ ë²„ì „ì„ ì¶”ê°€í•˜ì˜€ê³ , ë‚ ì§œëŠ” íš¨ìœ¨ì ì¸ ë¬¸ì„œ ê´€ë¦¬ë¥¼ ìœ„í•´ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.
es curatorë‚˜ ë°°ì¹˜ë¥¼ í†µí•´ ì˜¤ë˜ëœ ì¸ë±ìŠ¤ë¥¼ ì œê±°í•˜ê±°ë‚˜ ILM ê¸°ëŠ¥ê³¼ ê²°í•©í•˜ì—¬ hot-warm-cold ë°ì´í„° êµ¬ì¡°ë¥¼ êµ¬ì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
ë¬¼ë¡  ì¸ë±ìŠ¤ê°€ ë„ˆë¬´ ë§ì´ ìƒì„±ë˜ì§€ ì•Šë„ë¡ ì ì ˆí•œ ë³´ê´€ ì£¼ê¸°ë¥¼ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.

### alias
ê·¸ë ‡ë‹¤ë©´ `..., message_v0-20250215, message_v0-20250216` ì¸ë±ìŠ¤ë“¤ì— ëŒ€í•œ ê²€ìƒ‰ì„ ì–´ë–»ê²Œ í• ê¹Œìš”?

```
GET /message_v0-*/_search
{
  "query": {
    "match": {
      "content": "ì—”ì§„"
    }
  }
}
```
ìœ„ì™€ ê°™ì´ ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´ì„ ì§€ì›í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ìƒ‰ì¸ì€ ëª…í™•í•œ ì¸ë±ìŠ¤ì—, ê²€ìƒ‰ì€ ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´ì´ë‚˜ alias(ë³„ì¹­)ì„ ì¶”ê°€í•´ì„œ í˜¸ì¶œí•©ë‹ˆë‹¤.
```
POST /_aliases
{
  "actions": [
    {
      "add": {
        "index": "message_v0-*",
        "alias": "message"
      }
    }
  ]
}
```

## ì¸ë±ìŠ¤ í…œí”Œë¦¿(index template)
ì§€ê¸ˆê¹Œì§€ ë‚´ìš©ìœ¼ë¡œëŠ” ì¸ë±ìŠ¤ë¥¼ ë§¤ë²ˆ ìƒì„±í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ë‚ ì§œê°€ í¬í•¨ëë‹¤ë©´ ëŠ¦ì–´ë„ ìì • ì „ì—ëŠ” ë¯¸ë¦¬ ë§Œë“¤ì–´ì•¼ê² ì£ .
ì¸ë±ìŠ¤ í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ë©´ ì •ì˜ëœ ìƒˆë¡œìš´ ì¸ë±ìŠ¤ì— ëŒ€í•œ ìƒ‰ì¸ ì‹œ, ì¸ë±ìŠ¤ íŒ¨í„´ì— ë§¤ì¹­ë˜ëŠ” ê²½ìš° í•´ë‹¹ ì¸ë±ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.

ìµœì¢…ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ì¸ë±ìŠ¤ í…œí”Œë¦¿ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
PUT /_index_template/message_v0_template
{
  "index_patterns": ["message_v0-*"],
  "template": {
    "aliases": {
      "message": {}
    },
    "settings": {
      "refresh_interval": "1s",
      "number_of_shards": 4,
      "number_of_replicas": 1,
      "index": {
        "sort.field": "messageId",
        "sort.order": "desc",
        "analysis": {
          "tokenizer": {
            "nori_tokenizer": {
              "type": "nori_tokenizer",
              "decompound_mode": "none"
            }
          },
          "analyzer": {
            "nori_analyzer": {
              "type": "custom",
              "tokenizer": "nori_tokenizer",
              "filter": ["lowercase", "nori_part_of_speech"]
            }
          }
        }
      }
    },
    "mappings": {
      "dynamic": "strict",
      "properties": {
        "messageId": { "type": "long" },
        "chatId": { "type": "long" },
        "userId": { "type": "long" },
        "content": {
          "type": "text",
          "analyzer": "nori_analyzer",
          "search_analyzer": "nori_analyzer"
        },
        "createdAt": { "type": "date" }
      }
    }
  }
}
```

ë‹¤ìŒ í¸ì—ì„œëŠ” ìŠ¤í”„ë§ì„ í†µí•´ ESì™€ ì—°ë™í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤ğŸ¤—